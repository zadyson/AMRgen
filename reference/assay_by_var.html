<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a Stacked Bar Plot of Assay Values Colored by a Variable — assay_by_var • AMRgen</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a Stacked Bar Plot of Assay Values Colored by a Variable — assay_by_var"><meta name="description" content="This function creates a stacked bar plot using ggplot2, where the x-axis represents MIC (Minimum Inhibitory Concentration) or disk values, the y-axis indicates their frequency, and the bars are colored by a variable (by default, colours indicate whether the assay value is expressed as a range or not). Plots can optionally be faceted on an additional categorical variable. If breakpoints are provided, or species and drug are provided so we can extract EUCAST breakpoints, vertical lines indicating the S/R breakpoints and ECOFF will be added to the plot."><meta property="og:description" content="This function creates a stacked bar plot using ggplot2, where the x-axis represents MIC (Minimum Inhibitory Concentration) or disk values, the y-axis indicates their frequency, and the bars are colored by a variable (by default, colours indicate whether the assay value is expressed as a range or not). Plots can optionally be faceted on an additional categorical variable. If breakpoints are provided, or species and drug are provided so we can extract EUCAST breakpoints, vertical lines indicating the S/R breakpoints and ECOFF will be added to the plot."><meta property="og:image" content="https://AMRverse.github.io/AMRgen/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AMRgen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-book-open"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/AnalysingGenoPhenoData.html"><span class="fa fa-book"></span> Vignettes</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/AMRverse/AMRgen"><span class="fa fab fa-github"></span> Source Code</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generate a Stacked Bar Plot of Assay Values Colored by a Variable</h1>
      <small class="dont-index">Source: <a href="https://github.com/AMRverse/AMRgen/blob/main/R/assay_distribution.R" class="external-link"><code>R/assay_distribution.R</code></a></small>
      <div class="d-none name"><code>assay_by_var.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function creates a stacked bar plot using <code>ggplot2</code>, where the x-axis represents MIC (Minimum Inhibitory Concentration) or disk values, the y-axis indicates their frequency, and the bars are colored by a variable (by default, colours indicate whether the assay value is expressed as a range or not). Plots can optionally be faceted on an additional categorical variable. If breakpoints are provided, or species and drug are provided so we can extract EUCAST breakpoints, vertical lines indicating the S/R breakpoints and ECOFF will be added to the plot.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">assay_by_var</span><span class="op">(</span></span>
<span>  <span class="va">pheno_table</span>,</span>
<span>  antibiotic <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  measure <span class="op">=</span> <span class="st">"mic"</span>,</span>
<span>  colour_by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bar_cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  facet_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bp_site <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bp_S <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bp_R <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bp_ecoff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  species <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  guideline <span class="op">=</span> <span class="st">"EUCAST 2025"</span>,</span>
<span>  bp_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"#3CAEA3"</span>, R <span class="op">=</span> <span class="st">"#ED553B"</span>, E <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,</span>
<span>  x_axis_label <span class="op">=</span> <span class="st">"Measurement"</span>,</span>
<span>  y_axis_label <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  colour_legend_label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot_title <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-pheno-table">pheno_table<a class="anchor" aria-label="anchor" href="#arg-pheno-table"></a></dt>
<dd><p>Phenotype table in standard format as per import_ast().</p></dd>


<dt id="arg-antibiotic">antibiotic<a class="anchor" aria-label="anchor" href="#arg-antibiotic"></a></dt>
<dd><p>(optional) Name of an antibiotic to filter the 'drug_agent' column, and to retrieve breakpoints for.</p></dd>


<dt id="arg-measure">measure<a class="anchor" aria-label="anchor" href="#arg-measure"></a></dt>
<dd><p>Name of the column with assay measurements to plot (default "mic").</p></dd>


<dt id="arg-colour-by">colour_by<a class="anchor" aria-label="anchor" href="#arg-colour-by"></a></dt>
<dd><p>(optional) Field name containing a variable to colour bars by (default NULL, which will colour each bar to indicate whether the value is expressed as a range or not).</p></dd>


<dt id="arg-bar-cols">bar_cols<a class="anchor" aria-label="anchor" href="#arg-bar-cols"></a></dt>
<dd><p>(optional) Manual colour scale to use for bar plot. If NULL, <code>colour_by</code> variable is of class 'sir', bars will by default be coloured using standard SIR colours.</p></dd>


<dt id="arg-facet-var">facet_var<a class="anchor" aria-label="anchor" href="#arg-facet-var"></a></dt>
<dd><p>(optional) Column name containing a variable to facet on (default NULL).</p></dd>


<dt id="arg-bp-site">bp_site<a class="anchor" aria-label="anchor" href="#arg-bp-site"></a></dt>
<dd><p>(optional) Breakpoint site to retrieve (only relevant if also supplying <code>species</code> and <code>antibiotic</code> to retrieve breakpoints, and not supplying breakpoints via <code>bp_S</code>, <code>bp_R</code>, <code>ecoff</code>).</p></dd>


<dt id="arg-bp-s">bp_S<a class="anchor" aria-label="anchor" href="#arg-bp-s"></a></dt>
<dd><p>(optional) S breakpoint to plot.</p></dd>


<dt id="arg-bp-r">bp_R<a class="anchor" aria-label="anchor" href="#arg-bp-r"></a></dt>
<dd><p>(optional) R breakpoint to plot.</p></dd>


<dt id="arg-bp-ecoff">bp_ecoff<a class="anchor" aria-label="anchor" href="#arg-bp-ecoff"></a></dt>
<dd><p>(optional) ECOFF breakpoint to plot.</p></dd>


<dt id="arg-species">species<a class="anchor" aria-label="anchor" href="#arg-species"></a></dt>
<dd><p>(optional) Name of species, so we can retrieve breakpoints to print at the top of the plot to help interpret it.</p></dd>


<dt id="arg-guideline">guideline<a class="anchor" aria-label="anchor" href="#arg-guideline"></a></dt>
<dd><p>(optional) Guideline to use when looking up breakpoints (default 'EUCAST 2025').</p></dd>


<dt id="arg-bp-cols">bp_cols<a class="anchor" aria-label="anchor" href="#arg-bp-cols"></a></dt>
<dd><p>(optional) Manual colour scale for breakpoint lines.</p></dd>


<dt id="arg-x-axis-label">x_axis_label<a class="anchor" aria-label="anchor" href="#arg-x-axis-label"></a></dt>
<dd><p>(optional) String to label the x-axis (default "Measurement").</p></dd>


<dt id="arg-y-axis-label">y_axis_label<a class="anchor" aria-label="anchor" href="#arg-y-axis-label"></a></dt>
<dd><p>(optional) String to label the y-axis (default "Count").</p></dd>


<dt id="arg-colour-legend-label">colour_legend_label<a class="anchor" aria-label="anchor" href="#arg-colour-legend-label"></a></dt>
<dd><p>(optional) String to label the barplot fill colour legend (default NULL, which results in plotting the variable name specified via the 'colour_by' parameter).</p></dd>


<dt id="arg-plot-title">plot_title<a class="anchor" aria-label="anchor" href="#arg-plot-title"></a></dt>
<dd><p>(optional) String to title the plot (default indicates whether MIC or disk distribution is plotted, prefixed with the antibiotic name if provided, e.g. 'Ciprofloxacin MIC distribution')</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The stacked bar plot</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># plot MIC distribution, highlighting values expressed as ranges</span></span></span>
<span class="r-in"><span><span class="fu">assay_by_var</span><span class="op">(</span></span></span>
<span class="r-in"><span>  pheno_table <span class="op">=</span> <span class="va">ecoli_ast</span>, antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>,</span></span>
<span class="r-in"><span>  measure <span class="op">=</span> <span class="st">"mic"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="assay_by_var-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># colour by SIR interpretation recorded in column 'pheno_clsi'</span></span></span>
<span class="r-in"><span><span class="fu">assay_by_var</span><span class="op">(</span></span></span>
<span class="r-in"><span>  pheno_table <span class="op">=</span> <span class="va">ecoli_ast</span>, antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>,</span></span>
<span class="r-in"><span>  measure <span class="op">=</span> <span class="st">"mic"</span>, colour_by <span class="op">=</span> <span class="st">"pheno_clsi"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="assay_by_var-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># manually specify colours for the barplot</span></span></span>
<span class="r-in"><span><span class="fu">assay_by_var</span><span class="op">(</span></span></span>
<span class="r-in"><span>  pheno_table <span class="op">=</span> <span class="va">ecoli_ast</span>, antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>,</span></span>
<span class="r-in"><span>  measure <span class="op">=</span> <span class="st">"mic"</span>, colour_by <span class="op">=</span> <span class="st">"pheno_clsi"</span>,</span></span>
<span class="r-in"><span>  bar_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"skyblue"</span>, I <span class="op">=</span> <span class="st">"orange"</span>, R <span class="op">=</span> <span class="st">"maroon"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="assay_by_var-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># look up ECOFF and CLSI breakpoints and annotate these on the plot</span></span></span>
<span class="r-in"><span><span class="fu">assay_by_var</span><span class="op">(</span></span></span>
<span class="r-in"><span>  pheno_table <span class="op">=</span> <span class="va">ecoli_ast</span>, antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>,</span></span>
<span class="r-in"><span>  measure <span class="op">=</span> <span class="st">"mic"</span>, colour_by <span class="op">=</span> <span class="st">"pheno_clsi"</span>,</span></span>
<span class="r-in"><span>  species <span class="op">=</span> <span class="st">"E. coli"</span>, guideline <span class="op">=</span> <span class="st">"CLSI 2025"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   MIC breakpoints determined using AMR package: S &lt;= 0.25 and R &gt; 1</span>
<span class="r-plt img"><img src="assay_by_var-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># facet by method</span></span></span>
<span class="r-in"><span><span class="fu">assay_by_var</span><span class="op">(</span></span></span>
<span class="r-in"><span>  pheno_table <span class="op">=</span> <span class="va">ecoli_ast</span>, antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>,</span></span>
<span class="r-in"><span>  measure <span class="op">=</span> <span class="st">"mic"</span>, colour_by <span class="op">=</span> <span class="st">"pheno_clsi"</span>,</span></span>
<span class="r-in"><span>  species <span class="op">=</span> <span class="st">"E. coli"</span>, guideline <span class="op">=</span> <span class="st">"CLSI 2025"</span>,</span></span>
<span class="r-in"><span>  facet_var <span class="op">=</span> <span class="st">"method"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   MIC breakpoints determined using AMR package: S &lt;= 0.25 and R &gt; 1</span>
<span class="r-plt img"><img src="assay_by_var-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Free and Open Source (GPL-3), brought by AMRverse/AMRgen Development Team</p>
</div>

<div class="pkgdown-footer-right">
  <p>Our goal is to develop interpretive standards for AMR genotypes, akin to the interpretive standards developed by EUCAST and CLSI for antimicrobial susceptibility phenotyping.</p>
</div>

    </footer></div>





  </body></html>

