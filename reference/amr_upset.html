<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate Upset Plot — amr_upset • AMRgen</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Upset Plot — amr_upset"><meta name="description" content="This function generates an upset plot showing summaries of phenotype results (assay distributions, phenotype category percentages, and/or predictive value for phenotype) for each combination of markers observed in the data."><meta property="og:description" content="This function generates an upset plot showing summaries of phenotype results (assay distributions, phenotype category percentages, and/or predictive value for phenotype) for each combination of markers observed in the data."><meta property="og:image" content="https://AMRverse.github.io/AMRgen/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AMRgen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-book-open"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/AnalysingGenoPhenoData.html"><span class="fa fa-book"></span> Vignettes</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/AMRverse/AMRgen"><span class="fa fab fa-github"></span> Source Code</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generate Upset Plot</h1>
      <small class="dont-index">Source: <a href="https://github.com/AMRverse/AMRgen/blob/main/R/amr_upset.R" class="external-link"><code>R/amr_upset.R</code></a></small>
      <div class="d-none name"><code>amr_upset.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function generates an upset plot showing summaries of phenotype results (assay distributions, phenotype category percentages, and/or predictive value for phenotype) for each combination of markers observed in the data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">amr_upset</span><span class="op">(</span></span>
<span>  <span class="va">binary_matrix</span>,</span>
<span>  min_set_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  order <span class="op">=</span> <span class="st">""</span>,</span>
<span>  plot_set_size <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_category <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  print_category_counts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  print_set_size <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  boxplot_col <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>  assay <span class="op">=</span> <span class="st">"mic"</span>,</span>
<span>  SIR_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>S <span class="op">=</span> <span class="st">"#3CAEA3"</span>, I <span class="op">=</span> <span class="st">"#F6D55C"</span>, R <span class="op">=</span> <span class="st">"#ED553B"</span><span class="op">)</span>,</span>
<span>  antibiotic <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  species <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bp_site <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  guideline <span class="op">=</span> <span class="st">"EUCAST 2025"</span>,</span>
<span>  bp_S <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bp_R <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ecoff_bp <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-binary-matrix">binary_matrix<a class="anchor" aria-label="anchor" href="#arg-binary-matrix"></a></dt>
<dd><p>A data frame containing the original binary matrix output from the <code>get_binary_matrix</code> function. Expected columns are an identifier (column 1, any name), <code>pheno</code> (class sir, with S/I/R categories to colour points), <code>mic</code> (class mic, with MIC values to plot), and other columns representing gene presence/absence (binary coded, i.e., 1 = present, 0 = absent).</p></dd>


<dt id="arg-min-set-size">min_set_size<a class="anchor" aria-label="anchor" href="#arg-min-set-size"></a></dt>
<dd><p>An integer specifying the minimum size for a gene set to be included in the analysis and plots. Default is 2. Only genes with at least this number of occurrences are included in the plots.</p></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>A character string indicating the order of the combinations on the x-axis. Options are:</p><ul><li><p>"" (default): decreasing frequency of combinations</p></li>
<li><p>"genes": order by the number of genes in each combination</p></li>
<li><p>"value": order by the median assay value (MIC or disk zone) for each combination.</p></li>
</ul></dd>


<dt id="arg-plot-set-size">plot_set_size<a class="anchor" aria-label="anchor" href="#arg-plot-set-size"></a></dt>
<dd><p>Logical indicating whether to include a bar plot showing the set size (i.e., number of times each combination of markers is observed). Default is FALSE.</p></dd>


<dt id="arg-plot-category">plot_category<a class="anchor" aria-label="anchor" href="#arg-plot-category"></a></dt>
<dd><p>Logical indicating whether to include a stacked bar plot showing, for each marker combination, the proportion of samples with each phenotype classification (specified by the <code>pheno</code> column in the input file). Default is TRUE.</p></dd>


<dt id="arg-print-category-counts">print_category_counts<a class="anchor" aria-label="anchor" href="#arg-print-category-counts"></a></dt>
<dd><p>Logical indicating whether, if <code>plot_category</code> is TRUE, to print the number of strains in each resistance category for each marker combination in the plot. Default is FALSE.</p></dd>


<dt id="arg-print-set-size">print_set_size<a class="anchor" aria-label="anchor" href="#arg-print-set-size"></a></dt>
<dd><p>Logical indicating whether, if <code>plot_set_size</code> is TRUE, to print the number of strains with each marker combination on the plot. Default is FALSE.</p></dd>


<dt id="arg-boxplot-col">boxplot_col<a class="anchor" aria-label="anchor" href="#arg-boxplot-col"></a></dt>
<dd><p>Colour for lines of the box plots summarising the MIC distribution for each marker combination. Default is "grey".</p></dd>


<dt id="arg-assay">assay<a class="anchor" aria-label="anchor" href="#arg-assay"></a></dt>
<dd><p>A character string indicating whether to plot MIC or disk diffusion data. Must be one of:</p><ul><li><p>"mic": plot MIC data stored in column <code>mic</code></p></li>
<li><p>"disk": plot disk diffusion data stored in column <code>disk</code></p></li>
</ul></dd>


<dt id="arg-sir-col">SIR_col<a class="anchor" aria-label="anchor" href="#arg-sir-col"></a></dt>
<dd><p>A named vector of colours for the percentage bar plot. The names should be the phenotype categories (e.g., "R", "I", "S"), and the values should be valid color names or hexadecimal color codes. Default values are those used in the AMR package <code>scale_colour_sir()</code>.</p></dd>


<dt id="arg-antibiotic">antibiotic<a class="anchor" aria-label="anchor" href="#arg-antibiotic"></a></dt>
<dd><p>(optional) Name of antibiotic, so we can retrieve breakpoints to the assay value distribution plot.</p></dd>


<dt id="arg-species">species<a class="anchor" aria-label="anchor" href="#arg-species"></a></dt>
<dd><p>(optional) Name of species, so we can retrieve breakpoints to add to the assay value distribution plot.</p></dd>


<dt id="arg-bp-site">bp_site<a class="anchor" aria-label="anchor" href="#arg-bp-site"></a></dt>
<dd><p>(optional) Breakpoint site to retrieve (only relevant if also supplying <code>species</code> and <code>antibiotic</code> to retrieve breakpoints to plot, and not supplying breakpoints via <code>bp_S</code>, <code>bp_R</code>, <code>ecoff_bp</code>).</p></dd>


<dt id="arg-guideline">guideline<a class="anchor" aria-label="anchor" href="#arg-guideline"></a></dt>
<dd><p>(optional) Guideline to use when looking up breakpoints (default 'EUCAST 2025')</p></dd>


<dt id="arg-bp-s">bp_S<a class="anchor" aria-label="anchor" href="#arg-bp-s"></a></dt>
<dd><p>(optional) S breakpoint to add to plot (numerical).</p></dd>


<dt id="arg-bp-r">bp_R<a class="anchor" aria-label="anchor" href="#arg-bp-r"></a></dt>
<dd><p>(optional) R breakpoint to add to plot (numerical).</p></dd>


<dt id="arg-ecoff-bp">ecoff_bp<a class="anchor" aria-label="anchor" href="#arg-ecoff-bp"></a></dt>
<dd><p>(optional) ECOFF breakpoint to add to plot (numerical).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the following elements:</p><ul><li><p><code>plot</code>: A grid of plots displaying: (i) grid showing the marker combinations observed, MIC distribution per marker combination, frequency per marker and (optionally) phenotype classification and/or number of samples for each marker combination.</p></li>
<li><p><code>summary</code>: A data frame summarizing each marker combination observed, including median MIC (and interquartile range), number of resistant isolates, and positive predictive value for resistance.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">ecoli_geno</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_amrfp.html">import_amrfp</a></span><span class="op">(</span><span class="va">ecoli_geno_raw</span>, <span class="st">"Name"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">binary_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_binary_matrix.html">get_binary_matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  geno_table <span class="op">=</span> <span class="va">ecoli_geno</span>,</span></span>
<span class="r-in"><span>  pheno_table <span class="op">=</span> <span class="va">ecoli_ast</span>,</span></span>
<span class="r-in"><span>  antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>,</span></span>
<span class="r-in"><span>  drug_class_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Quinolones"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sir_col <span class="op">=</span> <span class="st">"pheno_clsi"</span>,</span></span>
<span class="r-in"><span>  keep_assay_values <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  keep_assay_values_from <span class="op">=</span> <span class="st">"mic"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Defining NWT in binary matrix using ecoff column provided: ecoff </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">amr_upset</span><span class="op">(</span><span class="va">binary_matrix</span>, min_set_size <span class="op">=</span> <span class="fl">3</span>, order <span class="op">=</span> <span class="st">"value"</span>, assay <span class="op">=</span> <span class="st">"mic"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="amr_upset-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $plot</span>
<span class="r-plt img"><img src="amr_upset-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 103 × 19</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    marker_list        marker_count     n combination_id   R.n   R.ppv R.ci_lower</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">""</span>                            0  <span style="text-decoration: underline;">2</span>590 0_0_0_0_0_0_0…    10 0.003<span style="text-decoration: underline;">86</span>    0.001<span style="text-decoration: underline;">47</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">"</span>qnrB<span style="color: #949494;">"</span>                        1     1 0_0_0_0_0_0_0…     1 1          1      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">"</span>parE_E460K, gyrA…            2     1 0_0_0_0_0_0_0…     1 1          1      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">"</span>parE_D475E<span style="color: #949494;">"</span>                  1    61 0_0_0_0_0_0_0…     0 0          0      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">"</span>qnrA1<span style="color: #949494;">"</span>                       1     2 0_0_0_0_0_0_0…     0 0          0      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">"</span>gyrA_S83A<span style="color: #949494;">"</span>                   1     3 0_0_0_0_0_0_0…     0 0          0      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">"</span>qnrB4<span style="color: #949494;">"</span>                       1     2 0_0_0_0_0_0_0…     2 1          1      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">"</span>parE_I355T<span style="color: #949494;">"</span>                  1    24 0_0_0_0_0_0_0…     0 0          0      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">"</span>marR_S3N<span style="color: #949494;">"</span>                    1    38 0_0_0_0_0_0_0…     4 0.105      0.007<span style="text-decoration: underline;">69</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">"</span>marR_S3N, parE_D…            2     4 0_0_0_0_0_0_0…     0 0          0      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 93 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 12 more variables: R.ci_upper &lt;dbl&gt;, NWT.n &lt;dbl&gt;, NWT.ppv &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   NWT.ci_lower &lt;dbl&gt;, NWT.ci_upper &lt;dbl&gt;, median_excludeRangeValues &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   q25_excludeRangeValues &lt;dbl&gt;, q75_excludeRangeValues &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   n_excludeRangeValues &lt;int&gt;, median_ignoreRanges &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   q25_ignoreRanges &lt;dbl&gt;, q75_ignoreRanges &lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Free and Open Source (GPL-3), brought by AMRverse/AMRgen Development Team</p>
</div>

<div class="pkgdown-footer-right">
  <p>Our goal is to develop interpretive standards for AMR genotypes, akin to the interpretive standards developed by EUCAST and CLSI for antimicrobial susceptibility phenotyping.</p>
</div>

    </footer></div>





  </body></html>

