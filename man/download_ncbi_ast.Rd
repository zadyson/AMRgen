% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/download_ncbi_ast.R
\name{download_ncbi_ast}
\alias{download_ncbi_ast}
\title{Download NCBI antimicrobial susceptibility testing (AST) data}
\usage{
download_ncbi_ast(
  species,
  antibiotic = NULL,
  max_records = 15000,
  batch_size = 200,
  sleep_time = 0.34,
  force_antibiotic = FALSE,
  reformat = FALSE,
  interpret_eucast = FALSE,
  interpret_clsi = FALSE,
  interpret_ecoff = FALSE
)
}
\arguments{
\item{species}{Character. Organism name for the search query
(e.g., \code{"Salmonella enterica"}). Required.}

\item{antibiotic}{Character or vector. Optional antibiotic name/s to filter
the returned data. Strings will be processed using the \pkg{AMR} package
to standardize names before matching, so e.g. \code{"amikacin"} or \code{"Amikacin"}
or \code{"ami"} will be parsed to "amikacin" before matching. This can be turned
off by setting \code{force_antibiotic=TRUE}. Full list of allowed antibiotic
names in NCBI: \url{https://www.ncbi.nlm.nih.gov/biosample/docs/antibiogram/}.}

\item{max_records}{Integer. Maximum number of BioSample records to
retrieve. Default is \code{15000}.}

\item{batch_size}{Integer. Number of records fetched per API request.
Default is \code{200} which is recommended by NCBI.}

\item{sleep_time}{Numeric. Seconds to pause between batch requests to
avoid overloading NCBI servers. Default is \code{0.34}.}

\item{force_antibiotic}{Logical. If \code{TRUE}, turns off standardizing the
antibiotic name using the \pkg{AMR} package before filtering, so that
matching is done exactly on the input string/s. Default is \code{FALSE}.}

\item{reformat}{Logical. If \code{TRUE}, reformats the output using
\link{import_ncbi_ast} for compatibility with AMR analysis workflows.
Default is \code{FALSE}. When set to \code{TRUE}, the data can also be interpreted
against breakpoints/ECOFF by setting the \verb{interpret_*=TRUE}.}

\item{interpret_eucast}{Logical. Passed to \link{import_ncbi_ast}.
If \code{TRUE}, interprets MIC values using EUCAST breakpoints. Default is
\code{FALSE}. Only used if \code{reformat}=\code{TRUE}.}

\item{interpret_clsi}{Logical. Passed to \link{import_ncbi_ast}.
If \code{TRUE}, interprets MIC values using CLSI breakpoints. Default is
\code{FALSE}. Only used if \code{reformat}=\code{TRUE}.}

\item{interpret_ecoff}{Logical. Passed to \link{import_ncbi_ast}.
If \code{TRUE}, interprets MIC values using ECOFF cutoffs. Default is \code{FALSE}.
Only used if \code{reformat}=\code{TRUE}.}
}
\value{
A tibble with one row per AST measure, with corresponding BioSample metadata.
}
\description{
This function downloads antimicrobial susceptibility testing (AST) data
from the NCBI Pathogen Detection database via the BioSample API. Data are
retrieved in batches, parsed from XML, and returned as a tidy tibble with
metadata including BioSample ID, Bioproject ID, and organism name.
}
\details{
The function constructs an Entrez query of the form:
\code{"<organism> AND antibiogram[filter]"}. XML records are downloaded
in batches, parsed, and combined into a single table. The resulting tibble
contains AST test results and associated metadata including:
\itemize{
\item \code{id}: BioSample identifier
\item \code{BioProject}: BioProject accession ID
\item \code{organism}: Organism name
\item \code{Antibiotic}, \code{Phenotype}, \code{Measurement}, \code{Units}, \code{Method}, \code{System},
\code{Manufacturer}, \code{Panel}, \code{Standard}: AST data columns
}

The function can optionally filter by a one or more antibiotics. It can
also optionally reformat data for compatibility with AMRgen functions via
\link{import_ncbi_ast}, and interpret the raw data measures against breakpoints or
ECOFF. See \link{import_ncbi_ast} for details of output formats when these options
are used.
}
\section{NCBI API usage}{

Users are encouraged to set an NCBI API key via
\code{rentrez::set_entrez_key()} to increase request limits and
comply with NCBI usage policies.
}

\examples{
\dontrun{
# Download AST data for Klebsiella quasipneumoniae
kq_ncbi <- download_ncbi_ast("Klebsiella quasipneumoniae")

# Download Klebsiella quasipneumoniae data, filter to amikacin and ampicillin
ast <- download_ncbi_ast(
  "Klebsiella quasipneumoniae",
  antibiotic = c("amikacin", "Amp")
)

# Reformat for AMRgen workflow with EUCAST interpretation
ast <- download_ncbi_ast(
  "Klebsiella quasipneumoniae",
  reformat = TRUE,
  interpret_eucast = TRUE
)
}

}
